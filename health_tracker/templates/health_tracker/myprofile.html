{% extends "health_tracker/layout.html" %}
{% load static %}
{% block title %}Home{% endblock %}
{% block styling %}<link href="{% static 'health_tracker/scss/dashboard.css' %}" rel="stylesheet">{% endblock %}
{% block body %}
    <main class="dashboard">
    <div>
        <div>
            <h1 class="title">Health Tracker</h1>
        </div>
    </div> 
    {% if nou %}
        <div class="dashboard__patient">
            <div class="dashboard__patient-personal">
                <h3>Full Name: {{user.full_name}}</h3>
                <h3>Email: {{user.person.email}}</h3>
                <h3>Well-Being ID: {{user.person.username}}</h3>
                <h3>Aadhar ID: {{user.aadharid}}</h3>
                <div  id="qrcode-generated">
                    {% csrf_token %}
                    <!--    this tag will generate the qrcode, the qrcode will be sent from the backend after it's generation-->
                        <img src="" alt="Invalid Image" id="qr-image" width="200px">
                    <script>

                        function set_image(blobResponse)
                        {
                            const imageObjectURL = URL.createObjectURL(blobResponse)
                            document.getElementById("qr-image").src = imageObjectURL;
                        }

                        function get_qr()
                        {
                        let token = $("input[name='csrfmiddlewaretoken']").val()
                        let url = "/getQr"
                        let header = {'X-CSRFToken': token}
                        let request = fetch(url, {method: "POST", headers: header, body: JSON.stringify({uid: "/visit/{{ user.wbid }}"})})
                        request.then(resp => resp.blob())
                        .then(set_image)
                        }
                        $(document).ready(get_qr)
                    </script>
                </div>
            </div>
            <div class="dashboard__health-stat">
                {% for health_value in health_status.health_status.all %}
                    <h4>
                        <div class="dashboard__progress-bar">
                            <div class="dashboard__progress" width=""
                        </div>
                        {{health_value.health_condition}}
                        
                        {{health_value.maximum_value}}
                        {{health_value.minimum_value}}
                        {{health_value.patient_value}}
                    </h4>
                    <h5>
                        {{health_value.condition_category}}
                    </h5>
                {% endfor %}
            </div>
        </div>
    {% elif non_nou %}
        <h3>
            {% if user.account.division.lower == 'd/hcw/ms' %} 
                Full Name: 
            {% else %} 
                Company Name: 
            {% endif %} 
                {{user.full_com_name}}
        </h3>
        <h3>
            Email: {{user.account.email}}
        </h3>
        <h3>
            Health Care Worker/Vendor ID: {{user.account.username}}
        </h3>
        <h3>Registration No./License No.: {{user.reg_no}}</h3>
        {% if user.account.division.lower == 'd/hcw/ms' %}
            <h3>
                Department: {{user.department}}
            </h3>
        {% endif %}
        <h3>
            Account Visibility: 
            {% if user.public %}
                Public
            {% else %}
                Private
            {% endif %}
        </h3>
        {% if user.public == True %}
            <button onclick="window.location.href='/goprivate'" >Go Private</button>
        {% else %}
            <button onclick="window.location.href='/gopublic'">Go Public</button>
        {% endif %}
    {% endif %}
{% endblock %}
{% block script %}
{% endblock script %}