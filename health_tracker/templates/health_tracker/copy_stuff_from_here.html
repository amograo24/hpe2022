{% extends "health_tracker/layout.html" %}

<!--copy paste the div tags here in your respective templates to make them work-->

{% block body %}
{% csrf_token %}
<input type="text" id="target_user">
<button id="test">test</button>
<button id="test2">check</button>
<div class="container" id="notifs">

</div>

<script>


    function handle_json(data)
    {
        for(var row of data)
        {
            $('#notifs').html(`<li>${row.sender} Sent A Letter of ${row.content}</li>`)
        }
    }
    function handle_rec()
    {
        let token = $("input[name='csrfmiddlewaretoken']").val()
        let header = {"X-CSRFToken": token}
        let payload = JSON.stringify({type: "receive"})
        let content = {
            method: "POST", headers: header, body: payload
        }
        let request = fetch("{% url 'notifications' %}", content)
        request.then((data) => {data.json().then(handle_json)})
    }

    function handle_send()
    {
        let token = $("input[name='csrfmiddlewaretoken']").val()
        let header = {"X-CSRFToken": token}
        let whom = $('#target_user').val()
        if(whom.length == 0)
        {
            alert('Whom to send?')
            return
        }
        let payload = JSON.stringify({to: whom, as: "{{ division }}", type: "send"})
        let content = 
        {
            method: "POST",
            headers: header,
            body: payload
        }
        let request = fetch("{% url 'notifications' %}", content)

    }

    $(document).ready(()=>{
        $("#test").click(handle_send)
        $("#test2").click(handle_rec)
    })

</script>
{% endblock body %}