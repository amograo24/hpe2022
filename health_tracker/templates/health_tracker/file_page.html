{% extends "health_tracker/layout.html" %}

{% block title %}{{wbid}}{% endblock %}


{% block body %}

{% csrf_token %}

<div id="files">
    <a href="#">Download</a>
</div>

<script>

    function handleBlob(blobResponse)
    {
        const imageObjectURL = URL.createObjectURL(blobResponse)
        $("a").attr("href", imageObjectURL)
        const code = `<img src="${imageObjectURL}"></embed>`
        $('#files').prepend(code)
    }

    function main()
    {
        let token = $("input[name='csrfmiddlewaretoken']").val()
        let url = "/get_file/{{ wbid }}/{{ name }}"
        let header = {'X-CSRFToken': token}
        let request = fetch(url, {method: "POST", headers: header})
        request.then(resp => resp.blob()).then(handleBlob)
    }
    $(document).ready(main)
</script>

{% endblock body %}